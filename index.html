<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ ‡é¢˜1</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#111a2e;
      --card2:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line:rgba(255,255,255,.08);
      --accent:#60a5fa;
      --accent2:#34d399;
      --radius:14px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"PingFang SC","Microsoft YaHei",Segoe UI,Roboto,Arial;
      background: radial-gradient(1200px 700px at 20% 0%, rgba(96,165,250,.18), transparent 55%),
                  radial-gradient(900px 600px at 90% 15%, rgba(52,211,153,.14), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:1200px; margin:0 auto; padding:22px 16px 40px;}
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:10px 0 14px;
    }
    h1{margin:0; font-size:26px; letter-spacing:.5px}
    .badge{font-size:12px; color:var(--muted)}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
    }

    /* Home layout */
    .homeHeader{
      display:flex; flex-direction:column; gap:12px;
      padding:16px;
    }
    .searchRow{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .input{
      flex:1;
      min-width:240px;
      display:flex; align-items:center; gap:10px;
      padding:12px 14px;
      border-radius:12px;
      background: rgba(0,0,0,.18);
      border:1px solid var(--line);
    }
    .input input{
      width:100%;
      border:0;
      outline:0;
      background:transparent;
      color:var(--text);
      font-size:14px;
    }
    .btn{
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-size:13px;
    }
    .btn:hover{border-color: rgba(96,165,250,.5)}
    .hint{color:var(--muted); font-size:12px}

    .grid{
      padding:16px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: repeat(2, 1fr);}
    }
    @media (max-width: 520px){
      .grid{grid-template-columns: 1fr;}
    }
    .tile{
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      background: rgba(0,0,0,.16);
      transition: transform .12s ease, border-color .12s ease;
      position:relative;
    }
    .tile:hover{transform: translateY(-2px); border-color: rgba(96,165,250,.45)}
    .thumb{
      width:100%;
      aspect-ratio: 16 / 9;
      background:#000;
      display:block;
      object-fit:cover;
    }
    .tileMeta{
      padding:10px 12px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .tileTitle{font-weight:650; font-size:13px}
    .tileSub{color:var(--muted); font-size:12px; margin-top:4px; line-height:1.25}
    .chip{
      font-size:11px;
      color: rgba(255,255,255,.85);
      border:1px solid var(--line);
      background: rgba(96,165,250,.12);
      padding:4px 8px;
      border-radius:999px;
      white-space:nowrap;
      height:fit-content;
    }

    .pager{
      padding:12px 16px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-top:1px solid var(--line);
    }
    .pagerLeft{display:flex; gap:10px; align-items:center;}
    .pageInfo{color:var(--muted); font-size:12px}

    /* Video page */
    .videoHeader{
      display:flex; align-items:center; gap:10px;
      padding:16px;
      border-bottom:1px solid var(--line);
    }
    .backBtn{
      border:1px solid var(--line);
      background: rgba(0,0,0,.2);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-size:13px;
    }
    .videoTitle{font-size:18px; font-weight:700}
    .videoLayout{
      display:grid;
      grid-template-columns: 1.8fr 1fr;
      gap:14px;
      padding:16px;
    }
    @media (max-width: 980px){
      .videoLayout{grid-template-columns: 1fr;}
    }
    .playerBox{
      padding:12px;
      border:1px solid var(--line);
      border-radius:14px;
      background: rgba(0,0,0,.18);
    }
    .playerBox video{
      width:100%;
      border-radius:12px;
      background:#000;
    }
    .sideCol{
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .sideCard{
      padding:14px;
      border:1px solid var(--line);
      border-radius:14px;
      background: rgba(0,0,0,.16);
    }
    .sideCard h3{
      margin:0 0 10px 0;
      font-size:14px;
      letter-spacing:.2px;
    }
    .desc{
      color:rgba(229,231,235,.92);
      font-size:13px;
      line-height:1.6;
      white-space:pre-wrap;
    }
    .empty{
      padding:16px;
      color:var(--muted);
      font-size:13px;
    }
    .footerNote{padding:0 16px 16px; color:var(--muted); font-size:12px;}
  </style>
</head>

<body>
  <div class="wrap">
    <!-- HOME -->
    <section id="homeView" class="card" style="display:none;">
      <div class="homeHeader">
        <div class="topbar">
          <div>
            <h1>æ ‡é¢˜1</h1>
            <div class="badge">è§†é¢‘ï¼šæŒ‰ m åºå·æ’åºï½œæ¯é¡µ 8 ä¸ªï¼ˆ2 è¡Œ Ã— 4 åˆ—ï¼‰</div>
          </div>
        </div>

        <div class="searchRow">
          <div class="input">
            <span style="color:var(--muted);font-size:13px;">ğŸ”</span>
            <input id="searchInput" placeholder="è¾“å…¥å…³é”®è¯ï¼ˆä¸åŒ…å« m1/m2 ç­‰åºå·å‰ç¼€ï¼‰" />
          </div>
          <button class="btn" id="clearBtn">æ¸…ç©º</button>
          <div class="hint" id="matchHint"></div>
        </div>
      </div>

      <div id="grid" class="grid"></div>

      <div class="pager">
        <div class="pagerLeft">
          <button class="btn" id="prevBtn">ä¸Šä¸€é¡µ</button>
          <button class="btn" id="nextBtn">ä¸‹ä¸€é¡µ</button>
        </div>
        <div class="pageInfo" id="pageInfo"></div>
      </div>
    </section>

    <!-- VIDEO PAGE -->
    <section id="videoView" class="card" style="display:none;">
      <div class="videoHeader">
        <button class="backBtn" id="backBtn">â† è¿”å›ä¸»é¡µ</button>
        <div class="videoTitle" id="videoTitle">å­æ ‡é¢˜</div>
      </div>

      <div class="videoLayout">
        <div class="playerBox">
          <video id="player" controls playsinline preload="metadata">
            <source id="playerSource" src="" type="video/mp4">
            ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ã€‚
          </video>
          <div class="footerNote" id="playerNote"></div>
        </div>

        <div class="sideCol">
          <div class="sideCard">
            <h3>ç®€ä»‹</h3>
            <div class="desc" id="descBox"></div>
          </div>

          <div class="sideCard">
            <h3>è®¿å®¢ç•™è¨€</h3>
            <!-- é™æ€ç«™æ— æ³•è‡ªè¡Œä¿å­˜ç•™è¨€ï¼Œè¿™é‡Œç”¨ Giscusï¼ˆGitHub Discussionsï¼‰ -->
            <div id="commentsBox" class="desc" style="color:var(--muted);">
              æ­£åœ¨åŠ è½½ç•™è¨€åŒºâ€¦
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

<script>
/** =======================
 *  ä½ éœ€è¦ä¿®æ”¹çš„é…ç½®
 *  ======================= */

// 1) ä½ çš„ R2 è‡ªå®šä¹‰åŸŸåï¼ˆä¸è¦ä»¥ / ç»“å°¾ï¼‰
const VIDEO_BASE_URL = "https://media.haiyidawangzifan.xyz";

// 2) æŠŠä½ æ‰€æœ‰ mp4 æ–‡ä»¶åï¼ˆä¸å¸¦ .mp4ï¼‰å¡«åˆ°è¿™é‡Œï¼Œçº¦ 40 ä¸ª
//    ä¾‹ï¼šå¯¹è±¡æ˜¯ m1Excel.mp4ï¼Œå°±å¡« "m1Excel"
const VIDEO_KEYS = [
  // --- ç¤ºä¾‹ï¼ˆæŠŠè¿™å‡ è¡Œæ›¿æ¢æˆä½ çœŸå®çš„ 40 ä¸ªï¼‰ ---
  // "m1demo",
  // "m2demo",
  // "m3demo",
  // "m4demo",
  // "m5demo",
  // "m6demo",
  // "m7demo",
  // "m8demo",
  // "m9demo"
  "Shape of Dreams 2025-10-04 12-55-04"
];

// 3) æ¯é¡µæ˜¾ç¤º 8 ä¸ªï¼ˆ2è¡Œ4åˆ—ï¼‰
const PAGE_SIZE = 8;

// 4) å¯é€‰ï¼šä¸ºæŸäº›è§†é¢‘å†™ç®€ä»‹ï¼ˆä¸å†™å°±ä¼šæ˜¾ç¤ºé»˜è®¤å ä½ï¼‰
const VIDEO_DESC = {
  // "m1demo": "è¿™æ˜¯ m1 çš„ç®€ä»‹ï¼Œæ”¯æŒå¤šè¡Œã€‚\nç¬¬äºŒè¡Œä¹Ÿå¯ä»¥ã€‚",
  "m1demo": "è¿™æ˜¯ m1 çš„ç®€ä»‹ï¼Œæ”¯æŒå¤šè¡Œã€‚\nç¬¬äºŒè¡Œä¹Ÿå¯ä»¥ã€‚"
  // "m2demo": "è¿™æ˜¯ m2 çš„ç®€ä»‹ï¼Œæ”¯æŒå¤šè¡Œã€‚\nç¬¬äºŒè¡Œä¹Ÿå¯ä»¥ã€‚"
};

// 5) Giscus ç•™è¨€ï¼ˆéœ€è¦ä½ åç»­æŠŠ data-repo ç­‰å¡«æˆä½ çš„ä»“åº“ï¼‰
//    å¦‚æœä½ æš‚æ—¶ä¸æƒ³åšç•™è¨€ï¼Œå¯ä»¥æŠŠ ENABLE_COMMENTS è®¾ä¸º false
const ENABLE_COMMENTS = true;
const GISCUS_CONFIG = {
  // ä½ éœ€è¦æŠŠä¸‹é¢è¿™äº›æ”¹æˆä½ è‡ªå·±çš„ï¼ˆæŒ‰ giscus.app é…ç½®é¡µé¢ç”Ÿæˆï¼‰
  repo: "jjy114514/jjy114514.github.io",
  repoId: "R_kgDORHiRYQ",
  category: "Ideas",
  categoryId: "DIC_kwDORHiRYc4C10nH",
};

/** =======================
 *  ä¸‹é¢æ˜¯é€»è¾‘ä»£ç ï¼ˆä¸€èˆ¬ä¸ç”¨æ”¹ï¼‰
 *  ======================= */

function extractNumber(key){
  const m = String(key).match(/^m(\d+)/i);
  return m ? Number(m[1]) : 0;
}

// å¿½ç•¥ m åçš„æ•°å­—å‰ç¼€ï¼ˆm1/m2/... ä¸ç®—å…³é”®è¯ï¼‰
function stripPrefix(key){
  return String(key).replace(/^m\d+/i, "");
}

function buildVideoObject(key){
  const num = extractNumber(key);
  const kw = stripPrefix(key); // å…³é”®è¯ä¸»ä½“
  return {
    id: key,
    num,
    keyword: kw,
    title: key,                  // ä½ ä¹Ÿå¯ä»¥æ”¹æˆæ›´å‹å¥½çš„æ ‡é¢˜ï¼š`m${num}` æˆ–å…¶ä»–
    subtitle: kw ? kw : `m${num}`,
    url: `${VIDEO_BASE_URL}/${key}.mp4`,
    desc: VIDEO_DESC[key] || `æš‚æ— ç®€ä»‹ï¼ˆå¯åœ¨ VIDEO_DESC é‡Œä¸º ${key} æ·»åŠ ï¼‰ã€‚`
  };
}

const VIDEOS = VIDEO_KEYS
  .map(buildVideoObject)
  .sort((a,b)=>a.num-b.num);

function qs(){
  return new URLSearchParams(location.search);
}

function setQuery(params){
  const url = new URL(location.href);
  Object.entries(params).forEach(([k,v])=>{
    if(v === null || v === undefined || v === "") url.searchParams.delete(k);
    else url.searchParams.set(k, String(v));
  });
  history.pushState({}, "", url);
}

function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

const homeView = document.getElementById("homeView");
const videoView = document.getElementById("videoView");

const grid = document.getElementById("grid");
const searchInput = document.getElementById("searchInput");
const clearBtn = document.getElementById("clearBtn");
const matchHint = document.getElementById("matchHint");

const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const pageInfo = document.getElementById("pageInfo");

const backBtn = document.getElementById("backBtn");
const videoTitle = document.getElementById("videoTitle");
const playerSource = document.getElementById("playerSource");
const player = document.getElementById("player");
const descBox = document.getElementById("descBox");
const commentsBox = document.getElementById("commentsBox");
const playerNote = document.getElementById("playerNote");

function normalizeText(s){
  return String(s || "").trim().toLowerCase();
}

function filterVideos(query){
  const q = normalizeText(query);
  if(!q) return VIDEOS;

  // åªæœï¼šå»æ‰ mæ•°å­—å‰ç¼€åçš„ keyword + åŸå§‹ idï¼ˆæ–¹ä¾¿ä½ ç›´æ¥è¾“å…¥ m12xxx ä¹Ÿèƒ½æœåˆ°ï¼‰
  return VIDEOS.filter(v=>{
    const hay = [
      v.keyword,
      v.id,
      v.subtitle,
      v.title
    ].map(normalizeText).join(" ");
    return hay.includes(q);
  });
}

function renderHome(){
  homeView.style.display = "";
  videoView.style.display = "none";

  const q = qs().get("q") || "";
  const page = Number(qs().get("page") || "1");

  // åŒæ­¥è¾“å…¥æ¡†
  if(searchInput.value !== q) searchInput.value = q;

  const filtered = filterVideos(q);
  const total = filtered.length;
  const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
  const curPage = clamp(page, 1, totalPages);

  // hintï¼ˆä½ è¯´â€œä¸å­˜åœ¨å°±ä»€ä¹ˆä¹Ÿä¸æ˜¾ç¤ºâ€ï¼Œæ‰€ä»¥è¿™é‡Œè½»æç¤ºä¸å¼ºåˆ¶æ˜¾ç¤ºä¹Ÿè¡Œï¼‰
  matchHint.textContent = q ? `åŒ¹é…ï¼š${total} ä¸ª` : `æ€»è®¡ï¼š${VIDEOS.length} ä¸ª`;

  // åˆ‡ç‰‡åˆ†é¡µ
  const start = (curPage - 1) * PAGE_SIZE;
  const pageItems = filtered.slice(start, start + PAGE_SIZE);

  // æŒ‰è¦æ±‚ï¼šè‹¥ä¸å­˜åœ¨åˆ™ç¼©ç•¥åŒºä»€ä¹ˆä¹Ÿä¸æ˜¾ç¤º
  grid.innerHTML = "";
  if(pageItems.length === 0){
    // ä¸æ˜¾ç¤ºä»»ä½• tileï¼›å¦‚æœä½ æƒ³æ›´å‹å¥½å¯å–æ¶ˆæ³¨é‡Šï¼š
    // grid.innerHTML = `<div class="empty">æœªæ‰¾åˆ°åŒ¹é…è§†é¢‘</div>`;
  } else {
    for(const v of pageItems){
      const a = document.createElement("a");
      a.className = "tile";
      a.href = `?v=${encodeURIComponent(v.id)}`;

      // ç”¨ video çš„é¦–å¸§åšç¼©ç•¥ï¼ˆ#t=0.1 é˜²æ­¢é»‘å±ï¼›preload=metadata é™ä½æµé‡ï¼‰
      // å¦‚æœä½ æœ‰ç‹¬ç«‹å°é¢å›¾ï¼Œä¹Ÿå¯ä»¥æ”¹æˆ <img src="...">
      a.innerHTML = `
        <video class="thumb" muted playsinline preload="metadata" src="${v.url}#t=0.1"></video>
        <div class="tileMeta">
          <div>
            <div class="tileTitle">${v.title}</div>
            <div class="tileSub">${v.keyword ? v.keyword : "ï¼ˆæ— å…³é”®è¯ï¼‰"}</div>
          </div>
          <div class="chip">m${v.num}</div>
        </div>
      `;
      grid.appendChild(a);
    }
  }

  prevBtn.disabled = (curPage <= 1);
  nextBtn.disabled = (curPage >= totalPages);
  pageInfo.textContent = `ç¬¬ ${curPage} / ${totalPages} é¡µ`;

  // å¦‚æœ URL page ä¸åˆæ³•ï¼Œçº æ­£ä¸€ä¸‹
  if(curPage !== page){
    setQuery({ page: curPage });
  }
}

function loadGiscusForVideo(videoId){
  if(!ENABLE_COMMENTS){
    commentsBox.textContent = "ç•™è¨€åŠŸèƒ½æœªå¯ç”¨ã€‚";
    return;
  }

  // æ¸…ç©ºæ—§çš„ giscus
  commentsBox.innerHTML = "";
  const existing = document.querySelector("script[data-giscus]");
  if(existing) existing.remove();
  const frame = document.querySelector(".giscus-frame");
  if(frame) frame.remove();

  // giscus ä½¿ç”¨ URL/è·¯å¾„æ˜ å°„è®¨è®ºä¸²ï¼Œè¿™é‡Œè®©æ¯ä¸ªè§†é¢‘å„è‡ªä¸€ä¸²
  const script = document.createElement("script");
  script.setAttribute("data-giscus", "true");
  script.src = "https://giscus.app/client.js";
  script.async = true;
  script.crossOrigin = "anonymous";

  script.setAttribute("data-repo", GISCUS_CONFIG.repo);
  script.setAttribute("data-repo-id", GISCUS_CONFIG.repoId);
  script.setAttribute("data-category", GISCUS_CONFIG.category);
  script.setAttribute("data-category-id", GISCUS_CONFIG.categoryId);

  // å…³é”®ï¼šæ¯ä¸ªè§†é¢‘ä¸€ä¸ª discussion
  script.setAttribute("data-mapping", "specific");
  script.setAttribute("data-term", `video:${videoId}`);

  script.setAttribute("data-reactions-enabled", "1");
  script.setAttribute("data-emit-metadata", "0");
  script.setAttribute("data-input-position", "top");
  script.setAttribute("data-theme", "dark");
  script.setAttribute("data-lang", "zh-CN");

  commentsBox.appendChild(script);
}

function renderVideo(){
  homeView.style.display = "none";
  videoView.style.display = "";

  const vid = qs().get("v");
  const v = VIDEOS.find(x => x.id === vid);

  if(!v){
    videoTitle.textContent = "å­æ ‡é¢˜ï¼ˆæœªæ‰¾åˆ°è§†é¢‘ï¼‰";
    descBox.textContent = "æœªæ‰¾åˆ°è¯¥è§†é¢‘ï¼Œè¯·è¿”å›ä¸»é¡µã€‚";
    playerSource.src = "";
    player.load();
    commentsBox.textContent = "æœªæ‰¾åˆ°è§†é¢‘ï¼Œç•™è¨€åŒºä¸å¯ç”¨ã€‚";
    return;
  }

  videoTitle.textContent = `å­æ ‡é¢˜${v.id}`;
  descBox.textContent = v.desc;

  playerSource.src = v.url;
  player.load();

  playerNote.textContent = `è§†é¢‘æºï¼š${v.url}`;

  loadGiscusForVideo(v.id);
}

function router(){
  const vid = qs().get("v");
  if(vid) renderVideo();
  else renderHome();
}

/** ====== äº‹ä»¶ç»‘å®š ====== */
searchInput.addEventListener("input", () => {
  // è¾“å…¥å³æœç´¢ï¼šæŠŠ q å†™å…¥ URLï¼ŒåŒæ—¶é‡ç½®é¡µç ä¸º 1
  setQuery({ q: searchInput.value.trim(), page: 1, v: null });
  router();
});

clearBtn.addEventListener("click", () => {
  searchInput.value = "";
  setQuery({ q: null, page: 1, v: null });
  router();
});

prevBtn.addEventListener("click", () => {
  const page = Number(qs().get("page") || "1");
  setQuery({ page: Math.max(1, page - 1), v: null });
  router();
});

nextBtn.addEventListener("click", () => {
  const page = Number(qs().get("page") || "1");
  setQuery({ page: page + 1, v: null });
  router();
});

backBtn.addEventListener("click", () => {
  // è¿”å›ä¸»é¡µå¹¶ä¿ç•™æœç´¢/é¡µç ä¹Ÿè¡Œï¼›è¿™é‡Œç›´æ¥å›ä¸»é¡µ
  setQuery({ v: null });
  router();
});

window.addEventListener("popstate", router);

// å¯åŠ¨
router();
</script>
</body>
</html>
